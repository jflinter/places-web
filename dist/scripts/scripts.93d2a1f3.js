"use strict";function isRetinaDisplay(){var a="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)";return window.devicePixelRatio>1?!0:window.matchMedia&&window.matchMedia(a).matches}angular.module("placesWebApp",["ngResource","ngRoute","ngSanitize","leaflet-directive","firebase"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/maps/:mapID",{templateUrl:"views/maps.html",controller:"MapsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("placesWebApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("placesWebApp").controller("MapsCtrl",["$scope","$firebase","$routeParams","leafletData","leafletEvents",function(a,b,c,d){var e={};a.title="Loading...",a.markers=[],d.getMap().then(function(a){var b=L.control.locate({follow:!1,setView:!1,markerStyle:{clickable:!1,pointerEvents:"none",className:"locate-circle"},locateOptions:{watch:!1}}).addTo(a);b.locate()}),a.$on("leafletDirectiveMap.popupopen",function(b,c){var f=c.leafletEvent.popup._container;$(f).addClass("animated-popup"),d.getMap().then(function(b){var d=c.leafletEvent.popup,f=$(d._content).data("placeid"),g=new Firebase("https://shareplaces.firebaseio.com/photos/"+f);g.once("value",function(b){var c=_.map(b.val(),function(a){return a.image})[0];if(c){var d=e[f];d.photoLoaded||(d.message+="<img class='places-image' src='data:image/png;base64,"+c+"' />",d.photoLoaded=!0,a.$apply())}});var h=b.getZoom(),i=d._latlng,j=170,k=b.project(i,h).subtract([0,j]);i=b.unproject(k,h),a.center={lat:i.lat,lng:i.lng,zoom:h}})}),a.$on("leafletDirectiveMap.popupclose",function(a,b){var c=b.leafletEvent.popup._container;$(c).removeClass("animated-popup")}),a.$on("leafletDirectiveMap.dragstart",function(){d.getMap().then(function(a){a.fire("preclick")})});var f=new Firebase("https://shareplaces.firebaseio.com/maps/"+c.mapID);f.once("value",function(b){var c=_.filter(_.map(b.val().places,function(a,b){return a.id=b,a}),function(a){return!a.PLCDeletedAt}),d=_.map(c,function(a){var b,c="";if(a.caption){var d=a.caption.split("\n");b=d[0],c=d.splice(1).join("<br>")}var f="<div class='marker-content' data-placeid='"+a.id+"'><div class='marker-title'>"+b+"</div>"+c+"</div>",g={lat:a.latitude,lng:a.longitude,message:f,icon:{iconUrl:isRetinaDisplay()?"images/pin@2x.png":"images/pin.png",iconSize:[14,36],iconAnchor:[7,36],shadowSize:[0,0],shadowUrl:"images/shadow.png"},popupOptions:{closeButton:!1,autoPan:!1,minWidth:260,maxWidth:260}};return e[a.id]=g,g}),f={northEast:{lat:_.max(_.map(c,"latitude")),lng:_.max(_.map(c,"longitude"))},southWest:{lat:_.min(_.map(c,"latitude")),lng:_.min(_.map(c,"longitude"))}};angular.extend(a,{title:b.val().name,markers:d,bounds:f,maxBounds:f}),a.$apply()});var g=isRetinaDisplay()?"@2x.png":".png",h="https://a.tiles.mapbox.com/v3/jflinter.icfgg4f5/{z}/{x}/{y}"+g;angular.extend(a,{defaults:{tileLayer:h,tileLayerOptions:{detectRetina:!0}},center:{lat:1,lng:1,zoom:1},bounds:{northEast:{lat:50.0077390146369,lng:-55.8984375},southWest:{lat:22.836945920943855,lng:-138.25195312499997}}})}]);